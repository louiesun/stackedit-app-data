# GFW的原理及绕过
> maoist2009

GFW，估计是目田起的，全称GreatFireWall，指的是中国的国际联网审查机器，但也成约定俗成的名字了。

## 审查机器
虽然gfw是wall，但是自由派往往称其为审查机器（censor）。

这是因为，反动政府无法完全阻断互联网，其作为第三次产业革命的产物早已深入社会生产的各个部分。这就像封建统治者不能禁止农民阶级拥有锄头一样。

因此，其需要识别流量，这就需要流量本身有特征，如没有加密，大小明显等。与此同时，审查机器所面对的是国际出入口每秒TB级别的出入数据（也就是几千部电影的大小），其必须能快速地处理数据流。这正是反动政府面对人民群众的劣势。反动政府的机器再好，也多不过人民群众手中设备的总和，只不过人民群众还没有团结起来罢了。
## 各级网络协
网络协议大致分为四层，就好像从物理到化学到生物学到社会学一样，每一层都有自己的规律，又为上一层所承载。
1. 为了讲清楚审查的过程，我会重点讲讲过程中泄露了哪些信息。
2. 为了规避审查，我们需要改变包的内容，所以需要知道我们能否有权限对这一层数据进行更改

### 数据链路层
这一层底下就是物理信号。该层搭建了一个局部的网络。

该层常见协议为以太网协议，这个网络中机器的编号叫mac号。

在这个网络中，所有机器可谓互相连接。类比邮件递送过程，这就像地方邮局，记录下了附近邮局和住户的实际地址，比如说某某路多少弄几号。每个数据包[^1]有一个源mac和目标mac。

[^1]: 可以理解成每个快递包裹，但是我们没有全球地图，只能和几个附近直接相连的个体对话。

这一层是一个叫做网卡的硬件负责的，即使是操作系统[^2]也无法自由控制[^3]。但是，特别的，mac号是由操作系统可以控制的。

[^2]: 也指有高权限的应用，所谓高权限权限如windows的admin权限，linux的root权限。

[^3]: 自由控制只能自由构造包裹，这一层来讲，比如说能不写mac号，或者在两个mac号中间插入别的东西，或把mac号放在数据后头等。

每台机器的mac号由网卡决定，每个网卡的默认mac号表示了厂商名，批次名和编号。每台设备默认mac号不一致，所以会被用来标识设备。当然，网卡提供操作修改自己mac号。

### ip层

这一层定义了一个互联的网络最大的ip网络就是全球互联网（公网），因为网络中参与者太多，很多时候这些人在一个小ip网络（局域网）中，共用一个上一级ip网络身份，甚至局域网也可以嵌套。

常见的协议有ipv4协议和ipv6协议。ipv6是因为ipv4地址不够用而提出的。你可以认为ip是一个家庭，共用一个编号（收件地址），如中南海习家。

显然，ip是被泄露了的。因此，审查机器可以阻止向特定的收件人送信。

这种封锁手段就叫**ip封锁**


## 翻墙

### 根本原理：流量转发

为了避开GFW的审查，最简单的思路是流量转发，就好像如果A不能直接写给B，就写信给C，内容是：

```plaintext
请转发给B
原内容
```
#### 困难一：流量识别.

显然，反动政府会想尽一切办法阻止我们绕过审查。然而，其不敢破坏正常流量的通行，因此，其会尝试寻找翻墙流量的特征。

以上面A发给C的信为例，每次都说：“请转发给…”特征十分明显。

特征并不局限于内容，甚至每个包的大小也是特征。

> 有的朋友可能说：“既然TLS可以加密内容何不加密信件内容呢?”但要注意，往往转发的内容也是TLS加密的。这叫“TLS in TLS”。
> 这里介绍一点，TLS握手包的大小是明显的，而加密基本不改变包大小，因此，“TLSinTLS”的前几个包大小规律明显，已被GFW识别。

为了防止流量识别，就需要设计协议。这里的协议就同之前各层的协议一样，规定了交流方式。

一般翻墙协议建立在TCP上，协议规定了客户端与代理服务器如何交流。

一些常见的目前可用开源协议为：VMESS，VLESS，Trojan，Stealth（Proton VPN），niaucchi4（迷雾通）

也有一些已被识别的切记如HTTP5，Sock(S)，OpenVPN，wireguard，masque等。

#### 困难二：出口IP

资产阶级又有一项臭名昭著的法权：版权。一部电影即使在一国家内购买，换个地方又要交一笔钱。

那么这种国别识别在网络中如何实现？靠的是IP地址。

以不少小资产阶级喜欢看的NetFlix为例，其只向特定地区提供服务，实际上就只有特定范围的IP能使用服务。

既然流量是由代理转发的，那么自然服务器获得的IP也是代理的，一般判断的国别也是代理的。

> 为什么说是一般呢?因而有的网站试图屏蔽代理以保护版权等，而有的代理用多了，会被标记为代理，然后被封锁。

对于无产阶级革命家，出口IP带来的问题主要在注册一些私有平台，如Google，Telegram。Google手机号注册疑似要求手机号与IP同国家，Telgram如果一个帐号IP多次改变（想象一个人一会儿在美国，一会儿去了印度尼西亚。)，可能导致封号。一些国内服务限制外国人使用。同志们接码时需注意。

当然，**自由平台不大会做这类限制**。

## 中修的GFW

这一章我们讲讲GFW的位置，和中修其他国家机器针对翻墙一事的行为。但要注意，我们无人参与了GFW建设，一切只是根据现象理性推测。

### GFW的位置

GFW有省墙和出口墙，有各自的封锁策略和任务，一般认为电信，移动，联通，教育网[^4]相对独独立
[^4]: 中修大部分学校的网络

#### 出口墙

在北上广的互联网国际出口，被认为有GFW出口墙。其负责IP黑洞，封锁一部分域名。

#### 省墙

一般认为各省甚至地级市的封锁互相独立。

省墙进行DNS污染，封锁更多域名，封锁一部分IP。

由于少教民族地区民族矛盾，一般此处封锁更严重。

### GFW的连接方式

GFW的计算机一般认为主要是并联[^5]。但IP封锁之类（非黑洞，主要是恶意丢包）似乎只能用串联解释。
[^5]: 初中物理知识，或可见青年自学丛书。你可以想象串联是在水管上直接建立大坝检查，并联是只有一部分水接受检查，其他直接流出。注意我们检查的是有没有水（对应计算机中0和1），所以并联仍然可以得到完整数据。

### 井GFW策略

很有意思，被识别的翻墙有的时候不被立即封锁，而是秋后1喝茶。

一般中修敏感时期，如两会，六四，国庆封锁变严。但显然对未识别协议无影响。

似乎一个IP流量大了（如共用节点）会被重点关注，可能会被人工复查决定是否封锁。

封锁发生在天，大概，动参

北，哈工大学生被认为是GFN☰☰力军，(也只是一小部分)

井井☰反动军警抓八手段

技术

一般认为只是缺钱了抓几个翻堵的凑世绩搞钱。少数突出者可能被人令

特别关照。

比如暮明目技术人员编程随想，应该被不还给令了。但一般认为他并未倒在GFN，

其死因为09年左右注册微博同名帐号。相反，目四并未报告IP抓人记录。

看了这么久，给大家讲个“笑话”。

>中修所谓翻端☰法的唯一相关法务为《互联网暂行管理办法》中，“任何织或

个人不得私自建立或使用修道进行国际联网。

>但信道的解释多是修传播介质，让光等。尽管仍使用修理，流里还是从电信，移动

职通三大运营高处由国示出口☰原场有光缆出国，并无建立传道。毕竟我们也天财才

力私拉海底光织式发射同步卫星….…

>然而，在资产阶级国家机等面前份并没有解释的权利，也无一丁点权力。

## 常见翻墙软件介绍。
具体界面操作此处略去

### V2Ray， Singbox.

这两个是主流的机场客户端。（往往其代理服务器也是这个软件，此外不深入）

+ 所谓节点，可以认为是一份这类软件的配置，告诉软件如何使用机场的代理服务
+ 所谓机场，就是用一些服务器（通常是买的）搭建了一匹节点用于出售。

这类软件是开源的，但机场主人不排除是晶哥。当然，此时泄漏的信息**同直连相同**。

### Proton VPN，Geph（迷雾通）

这是两个推荐的与中修无肉身关系（指作者中国人）的自由VPN，官方提供免费服务，速度适中，上XMPP，看网页（非视频）不成问题。

同时，这两项VPN也去打隐私，甚至采用了一些技术手段一定程度上保证这一点。

需要注意，Proton VPN使用时最好确保选择Stealth协议，默认WireGuard协议特征明显，极易被封锁。

### 小牛VPN，老王VPN等

不开源，极不安全，如老王VPN作者极有可能为网警。

无专业人员指导切记不要使用，其可能携带病毒。

尽管做好证书校验，泄雾信息与直连相同。但不排除其直接从手机获取信息上传。**对一些使用自由系统的同志，这使你刷机大概功亏一篑。**

而且你一般也不至于用这个。此类VPN可能断连，但上面的不咋会。

### Lantern等

蓝灯(Lantern)至少客户端开源，每天免费一定流量。但大概不至于使用。其他客户端开源VPN可以看看。

### TLsFragment与Accesser，ECH等

这并非翻墙工具，而是直连工具。利用了一些墙的漏洞。

> GFW有一些漏洞，比方说，想想你写收件人不是一行写完，而是一行一个字。因为GFW很忙就无法识别并TCP重置了。

工具都开源，TLsFragment为我编写。

TlsFragment泄露的**信息同直连**，但可以辅助任意基于TCP+TLS的工具。

Accesserr所利用的域前置不泄露sni，其他同直连，相比TlsFragment几乎支持全部网站，Accesser对CloudFlare 等CDN免费版的网站不支持。

ECH为sni加密技术，其他同直连，目前只有CloudflareCDN免费版支持。

本人不建议直连，但此类工具或许能帮你下到VPN软件…

很遗憾，目前TlsFragment和Accesser没有图形界面（TlsFragment有个Windows版本），有一定使用门槛。

### Tor Browser

Tor也就是洋葱网络，也是唯一的暗网。(其他都是诈骗或营销号瞎讲）。Tor Browser是一个Tor官方的自由浏览器，默认使用Tor网络。

叫洋葱的原因很形象。访问一个正常网站需要3个Tor节点，过程是
```mermaid
graph LR
客户端 --> 节点A
节点A --> 节点B
节点B --> 节点C
节点C --> 服务端
```

访问时，客户端先进行服务端的公钥TLS加密，再用C的公钥加密，再B再A。

发送时各级解密转发后才完成访问，犹如剥洋葱。(如果服务端也为暗网，过位为6个中级节点，不铺开)

这个过程中，A知道你的IP，C知道你访问的sni，服务器知道你访问的内容。但没人同时知道你的IP和访问了什么。只有同时控制ABC才能破解。但这不大可能。（Tor大概有700个用爱发电的节点，要控制100多个）

当然，这并不意味着你完全安全。如果服务端有问题，如是钓鱼网站，你电脑安全没做好，也有风险。

> FBI曾用钩鱼网站逮捕了一犯罪头子

然而，Tor的节点是公开的，已全部被GFW封锁。因此，Tor推出的网桥，用来连接A的代理。

同样的，代理有协议之分。如obfs4，meek，snowflake均已被识别，而Webtunnel无被识别记录。

网桥获取可前往官网，或者发邮件件，也可用VPN达到和网桥同样的目的。

由于tor的网桥一定意义上也是公开的，所以也会被针对封锁。

个人认为Tor并无必要，且多次转发、解密速度极慢，原本1s的网页加载可能延长至30s.

### WebRTC泄露IP问题

WebRTC被用于音视频同伙等，一般不经过代理，因此会导致IP泄漏。

若担心这一点，请设置代理(不铺开)或禁用WebRTC。(浏览器有插件等)




首灯闪烁为充电状态

使用前请打开机器底部翻盖

☰☰如何使用代理.

有些朋友可能问，TorBrowser可以用Ton网络，那如何让XMPP客户端使用呢?

☰井本地代理端

☰代理服务器未必是用来翻墙的，其只是用于转发流量的。流是也可以☰找到

木地端口。127.0.0.1就是回环端口，也即端同☰算机自身用的ZP。

此时代理也需要协议，一般采用简单的HTTSoc☰代理。

一些代理软件可以监听☰定端口，将此处收到数据转给远程代理服务器，

如速雾通监 10d9+TP代理，Pa1 SOCK代理。TLSpngmant 认监所 ☰2500HTH。

在调览容中，有责似于fuitchPronyOngn这类代理☰件，分统一的也有此项设置

虚拟网卡

Android机所谓建立虚拟连接永是此类，又称全局VPN

虚拟网卡模式将网卡收到流量全部先给代理应用。

相比于代理端口，虚拟网卡好处在于可以强制接收一切流是，而系统代理应用可不

遵守。

也有坏处，代理端上可以链式连接。如应用100g9(进运)2500lTLSFagmant)

→网卡→互联网，而一般只能有一个虚拟网卡。

好的代理软件应当允许放置☰置理，即配置流量发向哪里，也应当提供

气局

端☰作前置代理，但比类应用不多。

☰☰允许选择应用代理(的代现XMPP不代理收信)

##3行式办法

如果我们去培的宣传，为了不果善环，同时中修平可能要制境外观，可能想同时

使用海外华人宜国PN和protonWPNl，但两者均不好。

这时一个思路是在☰机收中以使用革命机开热点革命机开Pt。

洗晨就变成：“请grotmVPN轻说：请回回VPN转发：请QQ☰发消泉”

这里说意☰☰☰☰☰☰☰

空带代理a安各站b沪C公网服→b服a服月份

好你往板里放东西，先进的放在床下，最后拿出来。

☰网络☰☰身份

#☰邮箱

大部分服务注册需要一个邮箱。推荐proton，Tata。Gmail，Ou tlok也可。

注意☰大部分邮箱有一个字保邮箱机制。☰如果邮箱A空污点了，向隔B发确的信息，

使你能生密码。

三为何不能知道共前完码?因为一般现代服务器储存合希，而储你原密码，哈量计算在客户

端进行。

手机号

中修平台，国外一些大平台注册需手机号(5TG)，不建议用自己手机注册。

革命者个人不大需要此平台帐号。硬要注时，应接码，火概几块钱一个。

☰Mati，Xmpp

头夸好的时时通迅平台，有一些区别。

首石闪烁为充电状态

使用前请打开机器底部翻盖

☰☰如何使用代理.

有些朋友可能问，TorBrowcer可以用Tor网络，那如何让XMPP客户端使用呢?




蓝灯闪性为充电状态

使用前请打开机器底部翻道

两者均采用TLS加密，因此中间人无法知道内容。但smi和2P和有

连网站一样是泄露的。更进一步，NMPP大部方服务器端口并不是认

的443端口，有一定特征。

于MatnX与服务器交流默认基于HTT，而XMPP不是，因此MPP

并非天然有☰网页所客户端，不过也提出了折层的协议以支技网页端

二者为了防止服务器进行中间人攻击☰加容时服份等拿到了

反信息)，均提出了端可端加密功能，☰具体来说使只有互相

借任的客户端之间才能通信，更换客户端需要对方信任折客户端

才能加密通讯。

实名认证

中修真夸照考的平台，实名帐号☰坚决免涉改，

注意手机号大部分是实名的。

##元数据

元数据就仿佛计算机软件的禅，比说有的手机拍照

总喜欢附上经纬度和手机用户名;☰有的流农器总会说自己的

详细所本号。

可能一条头禅不能精确到什么，如很多人喜欢发“o”，

但同时☰喜欢说“00o”，“草”，“!!”，“啊这”的人可能就不多了。

元数据未必直接明什么，但☰用来判定☰价信息是否

来同一个人。

丁被

两

有一些软件可清除原数据，浏览器也有对应插件防止

一种叫浏览器拉纹的元数据被利用。

井网络问题快速诊断
<!--stackedit_data:
eyJoaXN0b3J5IjpbLTE4Mjc2MjU5NjEsMTAxNjUzMzEwNSwtMT
g4ODM1MTkxMCwtNjMyOTUyMjUzXX0=
-->