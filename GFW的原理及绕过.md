# GFW的原理及绕过
> maoist2009

GFW，估计是目田起的，全称GreatFireWall，指的是中国的国际联网审查机器，但也成约定俗成的名字了。

95512329+louiesun@users.noreply.github.com
179199418+maoist2009@users.noreply.github.comxmpp:gbudn19@conference.conversations.im?joinxmpp:%E9%A9%AC%E5%88%97%E6%AF%9B%E4%B8%BB%E4%B9%89%E7%BB%A7%E7%BB%AD%E9%9D%A9%E5%91%BD%E7%A4%BE@conference.conversations.im?joinimport osimport redef extract_authors(frontmatter):    authors = []    lines = frontmatter.split('\n')    for line in lines:        if line.strip().startswith('- 作者：'):            author = line.strip().replace('- 作者：', '')            authors.append(author)    if authors:9        return ', '.join(authors)    return Nonedef process_markdown_file(file_path, current_footnote_num):    with open(file_path, 'r', encoding='utf-8') as file:        content = file.read()    # 提取 frontmatter    frontmatter_match = re.match(r'---\s*(.*?)\s*---', content, re.DOTALL)    if frontmatter_match:        frontmatter = frontmatter_match.group(1)        content = content[frontmatter_match.end():].strip()        authors = extract_authors(frontmatter)    else:        authors = None    # 处理标题，将标题上升一级    new_content = []    first_title_found = False    for line in content.split('\n'):        if line.startswith('#'):            level = len(line) - len(line.lstrip('#'))            title = line.lstrip('#').strip()            if level == 1 and not first_title_found and authors:                title = f"{title} —— {authors}"                first_title_found = True            new_level = level + 1            new_title = f"{'#' * new_level} {title}"            new_content.append(new_title)        else:            new_content.append(line)    content = '\n'.join(new_content)    # 处理脚注    footnote_pattern = re.compile(r'\[\^(\d+)\]')    footnote_mapping = {}    new_content_lines = []    new_footnotes = []    # 先找出所有脚注定义并构建映射关系    for line in content.split('\n'):        if line.strip().startswith('[^'):            old_num = int(re.search(r'\[\^(\d+)\]', line).group(1))            new_num = current_footnote_num            footnote_mapping[old_num] = new_num            current_footnote_num += 1            new_line = line.replace(f"[^{old_num}]", f"[^{new_num}]")            new_footnotes.append(new_line)        else:            new_content_lines.append(line)    # 再替换正文中的脚注引用    new_content_text = '\n'.join(new_content_lines)    def replace_footnote(match):        old_num = int(match.group(1))        new_num = footnote_mapping.get(old_num)        return f"[^{new_num}]" if new_num is not None else match.group(0)    new_content_text = footnote_pattern.sub(replace_footnote, new_content_text)    if new_footnotes:        new_content_text += '\n\n' + '\n'.join(new_footnotes)    return new_content_text, current_footnote_numdef merge_markdown_files(output_file):    root_dir = os.getcwd()    markdown_files = []    for root, dirs, files in os.walk(root_dir):        for file in files:            if file.endswith('.md') and file.lower() != 'index.md':                markdown_files.append(os.path.join(root, file))    merged_content = []    current_footnote_num = 1    for file_path in markdown_files:        content, current_footnote_num = process_markdown_file(file_path, current_footnote_num)        merged_content.append(content)    with open(output_file, 'w', encoding='utf-8') as out_file:        out_file.write('\n\n'.join(merged_content))if __name__ == "__main__":    output_markdown_file = 'merged.md'    merge_markdown_files(output_markdown_file)    print(f"Markdown files merged into {output_markdown_file}")# gfw科普## 审查机器虽然gfw是wall，但是自由派往往称其为审查机器（censor）。这是因为，反动政府无法完全阻断互联网，其作为第三次产业革命的产物早已深入社会生产的各个部分。这就像封建统治者不能禁止农民阶级拥有锄头一样。因此，其需要识别流量，这就需要流量本身有特征，如没有加密，大小明显等。与此同时，审查机器所面对的是国际出入口每秒TB级别的出入数据（也就是几千部电影的大小），其必须能快速地处理数据流。这正是反动政府面对人民群众的劣势。反动政府的机器再好，也多不过人民群众手中设备的总和，只不过人民群众还没有团结起来罢了。## 各级网络协议网络协议大致分为四层，就好像从物理到化学到生物学到社会学一样，每一层都有自己的规律，又为上一层所承载。1. 为了讲清楚审查的过程，我会重点讲讲过程中泄露了哪些信息。2. 为了规避审查，我们需要改变包的内容，所以需要知道我们能否有权限对这一层数据进行更改### 数据链路层这一层底下就是物理信号。该层搭建了一个局部的网络。该层常见协议为以太网协议，这个网络中机器的编号叫mac号。在这个网络中，所有机器可谓互相连接。类比邮件递送过程，这就像地方邮局，记录下了附近邮局和住户的实际地址，比如说某某路多少弄几号。每个数据包[^1]有一个源mac和目标mac。[^1]: 可以理解成每个快递包裹，但是我们没有全球地图，只能和几个附近直接相连的个体对话。这一层是一个叫做网卡的硬件负责的，即使是操作系统[^2]也无法自由控制[^3]。但是，特别的，mac号是由操作系统可以控制的。[^2]: 也指有高权限的应用，所谓高权限权限如windows的admin权限，linux的root权限。[^3]: 自由控制只能自由构造包裹，这一层来讲，比如说能不写mac号，或者在两个mac号中间插入别的东西，或把mac号放在数据后头等每台机器的mac号由网卡决定，每个网卡的默认mac号表示了厂商名，批次名和编号。每台设备默认mac号不一致，所以会被用来标识设备。当然，网卡提供操作修改自己mac号。### ip层这一层定义了一个互联的网络最大的ip网络就是全球互联网（公网），因为网络中参与者太多，很多时候这些人在一个小ip网络（局域网）中，共用一个上一级ip网络身份，甚至局域网也可以嵌套。常见的协议有ipv4协议和ipv6协议。ipv6是因为ipv4地址不够用而提出的。你可以认为ip是一个家庭，共用一个编号（收件地址），如中南海习家。显然，ip是被泄露了的。因此，审查机器可以阻止向特定的收件人送信。这种封锁手段就叫**ip黑洞**
<!--stackedit_data:
eyJoaXN0b3J5IjpbODA1MTk4ODYyLC02MzI5NTIyNTNdfQ==
-->